<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>The Sparta Modeling Framework: Core Example Using Sparta</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">The Sparta Modeling Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('core_example.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Core Example Using Sparta</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The Sparta core example is located in sparta/example/CoreModel.</p>
<hr  />
 <h1><a class="anchor" id="example_core"></a>
Example Core Layout</h1>
<p>The CoreExample is an example Sparta simulator that uses the Sparta framework to mimic a very rudimentary model of a simple out-of-order core. The model does not have dependency checking nor actually renames any instructions. The "ISA" used is a few random instructions pulled from the PowerPC ISA listed in a table in <a class="el" href="Fetch_8cpp.html" title="Implementation of the CoreModel Fetch unit.">Fetch.cpp</a>.</p>
<p>For a more concrete core performance model, check out the RISC-V Performance Model based on Sparta: <a href="https://github.com/riscv-software-src/riscv-perf-model">https://github.com/riscv-software-src/riscv-perf-model</a></p>
<p>The example touches on Sparta command line simulation, construction phasing, unit creation, port creation and binding, event creation, and data transfer.</p>
<p>The ExampleCore has a simple pipeline:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
<map name="dot_inline_dotgraph_2.map" id="dot_inline_dotgraph_2.map"><area shape="rect" href="Fetch_8hpp.html" title="\N" alt="" coords="5,276,77,325"/>
<area shape="rect" href="Decode_8hpp_source.html" title="\N" alt="" coords="198,276,270,325"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="78,298,183,298,183,303,78,303"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="101,280,174,301"/>
<area shape="rect" href="Rename_8hpp_source.html" title="\N" alt="" coords="391,276,463,325"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="271,298,376,298,376,303,271,303"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="294,280,367,301"/>
<area shape="rect" href="Dispatch_8hpp_source.html" title="\N" alt="" coords="584,276,657,325"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="464,298,569,298,569,303,464,303"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="487,280,560,301"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="778,16,850,65"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="621,276,627,219,638,149,655,83,666,58,679,41,698,30,720,25,763,26,763,31,720,30,700,35,682,45,670,61,660,85,643,150,632,220,626,277"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="704,5,731,26"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="778,131,850,180"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="620,276,625,245,635,209,652,173,679,145,699,136,721,132,763,136,763,141,721,137,701,141,682,150,656,177,640,211,630,246,626,277"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="704,114,731,135"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="778,227,850,276"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="642,274,659,260,680,249,722,241,763,241,763,246,722,246,682,254,662,264,645,278"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="704,222,731,243"/>
<area shape="rect" href="Execute_8hpp_source.html" title="\N" alt="" coords="778,328,850,377"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="658,310,681,317,764,338,763,343,680,322,656,315"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="704,298,731,319"/>
<area shape="rect" href="LSU_8hpp_source.html" title="\N" alt="" coords="778,443,850,492"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="634,324,654,361,683,397,722,426,765,447,762,452,720,431,679,401,649,364,629,326"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="704,378,731,399"/>
<area shape="rect" href="ROB_8hpp_source.html" title="\N" alt="" coords="778,531,850,580"/>
<area shape="poly" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="624,325,627,365,636,414,653,465,666,488,683,509,700,524,720,535,763,548,762,553,718,539,697,528,679,513,662,491,648,467,630,416,622,366,619,326"/>
<area shape="rect" href="CoreTypes_8hpp_source.html" title="InstGroup" alt="" coords="681,490,754,511"/>
<area shape="rect" href="BIU_8hpp_source.html" title="\N" alt="" coords="925,444,997,493"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="850,465,910,466,910,471,850,470"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="874,447,901,468"/>
<area shape="rect" href="MSS_8hpp_source.html" title="\N" alt="" coords="1072,444,1144,493"/>
<area shape="poly" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="997,466,1057,466,1057,471,997,471"/>
<area shape="rect" href="ExampleInst_8hpp_source.html" title="Inst" alt="" coords="1021,448,1048,469"/>
</map>
</div>
<p>This heirarchy is built in core_example::ExampleSimulator::buildTree_ pulling resources and factories from <a class="el" href="classcore__example_1_1CoreTopology__1.html" title="CoreTopology_1 topology class.">core_example::CoreTopology_1</a>.</p>
<p>Instructions are created in <code>Fetch</code> and progression of these instructions is based on a credit system. Credits flow from <code>ROB</code> through <code>Dispatch</code> though <code>Rename</code>, etc. in 0 time (dotted lines) while instructions flow from <code>Fetch</code> to <code>Decode</code> to <code>Rename</code>, etc (solid lines) in a delay of 1 cycle. This flow is controlled based on the rule (adopted by this example) that all <code>DataInPorts&lt;core_example::InstGroup&gt;</code> take objects delayed by 1 cycle (set at instantiation time) and all credit <code>DataInPorts&lt;uint32_t&gt;</code> are assumed to be 0 cycle. For example:</p>
<div class="dotgraph">
<img src="dot_inline_dotgraph_3.png" alt="dot_inline_dotgraph_3.png" border="0" usemap="#dot_inline_dotgraph_3.map"/>
</div>
<p>These ports are bound in core_example::ExampleSimulator::bindTree_, using the <code>port_connections</code> list defined in <a class="el" href="classcore__example_1_1CoreTopology__1.html" title="CoreTopology_1 topology class.">core_example::CoreTopology_1</a>. The ports themselves are instantiated in <a class="el" href="Fetch_8cpp.html" title="Implementation of the CoreModel Fetch unit.">Fetch.cpp</a> / <a class="el" href="Fetch_8hpp.html" title="Definition of the CoreModel Fetch unit.">Fetch.hpp</a> and <a class="el" href="Decode_8cpp_source.html">Decode.cpp</a> / <a class="el" href="Decode_8hpp_source.html">Decode.hpp</a>.</p>
<p>Without the delay of 1 cycle on the <code>in_fetch_queue_write</code>, we will come across a cycle in simulation:</p>
<div class="fragment"><div class="line">Step.Time</div>
<div class="line">   1.0    Fetch receive credits</div>
<div class="line">   2.0    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">   3.0    Decode would receive <span class="keyword">new</span> instructions and process</div>
<div class="line">   4.0    Decode send credits back to Fetch</div>
<div class="line">   5.0    Goto 1?? Oops! Infinite loop!</div>
</div><!-- fragment --><p>Adding the cycle delay:</p>
<div class="fragment"><div class="line">Step.Time</div>
<div class="line">   1.0    Fetch receive credits</div>
<div class="line">   2.0    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">        ... delay</div>
<div class="line">   1.1    Decode would receive <span class="keyword">new</span> instructions and process</div>
<div class="line">   2.1    Decode send credits back to Fetch</div>
<div class="line">   3.1    Fetch receive credits</div>
<div class="line">   4.1    Fetch sends <span class="keyword">new</span> instructions on the out port</div>
<div class="line">        ... delay, etc, etc</div>
</div><!-- fragment --><p>The entire core example follows this paradigm.</p>
<hr  />
 <h1><a class="anchor" id="Building"></a>
Building</h1>
<p>To build the CoreExample, simply type <code>make</code> in the <code>example/CoreModel</code> directory.</p>
<p>Refer to builtin help for up-to-date help and commands, but try running the model with the '-h' option.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -h</div>
<div class="line">% ./sparta_core_example --verbose-help</div>
<div class="line">% ./sparta_core_example --help-topic reporting</div>
</div><!-- fragment --><p>Most of the commands listed in the help are directly from the Sparta framework and not <code>sparta_core_example</code>. These are "free" commands the framework provides (via <a class="el" href="classsparta_1_1app_1_1CommandLineSimulator.html" title="Command line simulator front-end class with argument parsing Works in conjunction with sparta::app::S...">sparta::app::CommandLineSimulator</a>). The modeler is <em>not</em> required to use this class for simulation.</p>
<hr  />
 <h1><a class="anchor" id="Invocations"></a>
Invocations</h1>
<h2><a class="anchor" id="run_config_core_example"></a>
Running/Configuring</h2>
<p>Dump out the parameters:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --no-run \</div>
<div class="line">                        --write-<span class="keyword">final</span>-config-verbose params.yaml</div>
</div><!-- fragment --><p>Read in parameters from a file and/or change via the command line. Parameters are set <em>in the order</em> in which they are read from the command line.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -c params.yaml -p top.cpu.core?.fetch.params.num_to_fetch 2</div>
<div class="line"> </div>
<div class="line">  [in] Configuration: Node <span class="stringliteral">&quot;&quot;</span> &lt;- file: <span class="stringliteral">&quot;params.yaml&quot;</span></div>
<div class="line">  [in] Configuration: Parameter <span class="stringliteral">&quot;top.cpu.core?.fetch.params.num_to_fetch&quot;</span> &lt;- value: <span class="stringliteral">&quot;2&quot;</span></div>
</div><!-- fragment --><p>Run for 1 million cycles, incrementing a ctr every 1000 cycles. Consume the config file test.yaml and produce a final yaml file called final.yaml. Also, dump the tree:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1M \</div>
<div class="line">                     --show-tree -p top.core0.params.ctr_incr_period 1000 \</div>
<div class="line">                     -c test.yaml --write-<span class="keyword">final</span>-config <span class="keyword">final</span>.yaml</div>
</div><!-- fragment --><h2><a class="anchor" id="debugging_logging_core_example"></a>
Debugging/Logging</h2>
<p>Enable a Decode "info" log for 1,000 cycles.</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1K -l top.cpu.core?.decode info decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1,000 cycles to the same file:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1K -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                              -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1K cycles <em>after</em> the first 100K cycles:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --debug-on 100K -r 101K \</div>
<div class="line">                     -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                     -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><p>Enable a Decode and Fetch "info" log for 1K instructions <em>after</em> the first 100K instructions:</p>
<div class="fragment"><div class="line">% ./sparta_core_example --debug-on-icount 100K -i 101K \</div>
<div class="line">                     -l top.cpu.core?.decode info fetch_decode.out \</div>
<div class="line">                     -l top.cpu.core?.fetch  info fetch_decode.out</div>
</div><!-- fragment --><h2><a class="anchor" id="reporting_core_example"></a>
Generating Reports</h2>
<p>Refer to <a class="el" href="report_def_format.html">Report Definition Format (.rrep,.yaml)</a> for more details on Reports.</p>
<p>Dump out a full, simple report report in html:</p>
<div class="fragment"><div class="line">% ./sparta_core_example -r 1000000 --report-all output.html html</div>
<div class="line">% ./sparta_core_example -r 1M --report-all output.html html  # Same command</div>
</div><!-- fragment --><p>Dump out a full, simple report with rules. The content is all inclusive of the entire simulation tree (the "" on the command line)</p>
<div class="fragment"><div class="line">% cat simple_stats.yaml</div>
<div class="line">content:</div>
<div class="line">subreport:</div>
<div class="line">  name: AUTO</div>
<div class="line">  content:</div>
<div class="line">    autopopulate: <span class="keyword">true</span></div>
<div class="line">% ./sparta_core_example -r 1M --report <span class="stringliteral">&quot;&quot;</span> simple_stats.yaml my_report.txt text</div>
</div><!-- fragment --><p>Dump out subset, but simple report with rules. The content is inclusive of the decode tree only for all cores:</p>
<div class="fragment"><div class="line">% cat simple_stats.yaml</div>
<div class="line">content:</div>
<div class="line">subreport:</div>
<div class="line">  name: AUTO</div>
<div class="line">  content:</div>
<div class="line">    autopopulate: <span class="keyword">true</span></div>
<div class="line">% ./sparta_core_example -r 1M --report <span class="stringliteral">&quot;top.cpu.core?.decode&quot;</span> simple_stats.yaml my_report.txt text</div>
</div><!-- fragment --><p>Create a <code>ts_report.yaml</code> file to dump out a time-series CSV report (must be run in <code>example/CoreModel</code> directory for the <code>core_stats.yaml</code> file). This is triggered on the stat <code>total_number_retired</code> reaching 3500 insts or greater. It's trigged "on" only once.</p>
<div class="fragment"><div class="line">% cat &gt; ts_report.yaml</div>
<div class="line">content:</div>
<div class="line"> </div>
<div class="line">report:</div>
<div class="line">  pattern:   top.cpu.core0</div>
<div class="line">  def_file:  core_stats.yaml</div>
<div class="line">  dest_file: core0.csv</div>
<div class="line">  format:    csv</div>
<div class="line">  trigger:</div>
<div class="line">    start:   rob.stats.total_number_retired &gt;= 3500</div>
<div class="line">    update-time: 5 ns</div>
<div class="line"> &lt;ctrl-D&gt;</div>
<div class="line"> % ./sparta_core_example -r 1M --report ts_report.yaml</div>
</div><!-- fragment --><h2><a class="anchor" id="pipeouts_core_example"></a>
Generating Pipeouts</h2>
<p>Refer to <a href="https://github.com/sparcians/map/tree/master/helios/pipeViewer">https://github.com/sparcians/map/tree/master/helios/pipeViewer</a> for directions on building/installing the MAP::Helios::Argos tools preferably using the Conda tools.</p>
<p>Create a 10K instructions Pipeout:</p>
<div class="fragment"><div class="line">% pwd</div>
<div class="line">$HOME/map/<a class="code hl_namespace" href="namespacesparta.html">sparta</a>/build/example/CoreModel</div>
<div class="line">% ./sparta_core_example -i10K -z my_pipeout</div>
<div class="ttc" id="anamespacesparta_html"><div class="ttname"><a href="namespacesparta.html">sparta</a></div><div class="ttdoc">Macros for handling exponential backoff.</div><div class="ttdef"><b>Definition</b> <a href="AppTriggers_8hpp_source.html#l00022">AppTriggers.hpp:22</a></div></div>
</div><!-- fragment --><p>This will create a set of files for the Argos viewer:</p>
<div class="fragment"><div class="line">% ls -1 my_pipeout*</div>
<div class="line">my_pipeoutclock.dat</div>
<div class="line">my_pipeoutdata.dat</div>
<div class="line">my_pipeoutdisplay_format.dat</div>
<div class="line">my_pipeoutindex.bin</div>
<div class="line">my_pipeoutlocation.dat</div>
<div class="line">my_pipeoutmap.dat</div>
<div class="line">my_pipeoutrecord.bin</div>
<div class="line">my_pipeoutsimulation.info</div>
<div class="line">my_pipeoutstring_map.dat</div>
</div><!-- fragment --><p>Launch the MAP::Helio::Argos viewer (this assumes the correct tools/libaries have been installed). Note that the <code>cpu_layout.alf</code> file is NOT in the build directory of the CoreModel.</p>
<div class="fragment"><div class="line">% pwd</div>
<div class="line">$HOME/map/<a class="code hl_namespace" href="namespacesparta.html">sparta</a>/build/example/CoreModel</div>
<div class="line">% python3 $HOME/map/helios/pipeViewer/pipe_view/argos.py \</div>
<div class="line">       -l $HOME/map/<a class="code hl_namespace" href="namespacesparta.html">sparta</a>/example/CoreModel/cpu_layout.alf \</div>
<div class="line">       -d my_pipeout</div>
</div><!-- fragment --><p>The view that pops up is a <em>single-cycle</em> view of the CPU. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 22 2025 17:16:11 for The Sparta Modeling Framework by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
